---
date: "2025-11-23T16:59:31+08:00"
draft: false
title: "五层模型"
categories:
  - ComputerNetworks
tags:
  - 应用层
  - 运输层
  - 网络层
  - 链路层
  - 物理层
---

五层模型从上到下依次为应用层、运输层、网络层、链路层、物理层。每一层只负责特定的功能，再通过与上下层的协作，完成端到端的数据传输。

## 应用层

直接面向用户，提供各类网络应用服务。

### 功能

- 定义应用程序间的通信规则。
- 处理数据格式。
- 管理会话，协调通信双方的交互逻辑。
  - 管理什么会话
    - 端到端交互链路
    - 交互状态
  - 如何管理
    - 建立会话
    - 维护会话
    - 终止会话

### 关键协议

- HTTP/HTTPS：网页传输协议
- SMTP：邮件传输协议
- FTP：文件传输协议
- DNS：域名解析协议

## 运输层

负责将应用层的数据打包后，通过端口号定位到目标设备的具体应用，实现端到端的可靠传输。

### 功能

- 建立端到端的联系
- 选择传输方式
  - 可靠传输
  - 不可靠传输
- 处理流量控制和拥塞控制
- 通过端口号识别目标应用

### 关键协议

#### TCP：传输控制协议

可靠、面向连接：传输前必须先进行三次握手，传输过程中确认数据是否送达、重传丢失的数据，并通过窗口机制控制流量和拥塞。

适用于对数据可靠性有较高要求的场景：

- 网页加载
- 文件下载
- 邮件发送

##### 三次握手

1. 客户端发送 `SYN` 包请求连接
2. 服务器响应 `SYN-ACK` 包，表示同意连接
3. 客户端发送 `ACK` 包，确认连接建立

##### 四次挥手

1. 客户端发送 `FIN=1`（请求断开），`ACK=1`（确认之前的数据），序号=`X`。
2. 服务器回复 `ACK=1`（确认收到断开请求），序号=`Y`，确认号=`X+1`。
3. 服务器发送 `FIN=1`（请求断开），`ACK=1`（确认之前的数据），序号=`Z`，确认号=`X+1`。
4. 客户端回复 `ACK=1`（确认收到断开请求），序号=`X+1`，确认号=`Z+1`。

##### 序号

- 标记发送方当前发送数据的字节位置，确保接收方按序重组数据。
- TCP 连接建立时，双方会随机生成初始序号（ISN），避免因旧连接的残留报文干扰。
- 序号值=初始序号+已发送字节数

##### 确认号

- 确认号值=期望接收的下一个字节序号=已接收字节的最后序号+1
- 确认号仅在 ACK 标志位为 1 时有效。

##### 窗口

- 实现流量控制和拥塞控制，防止发送方发送过多数据淹没接收方。
- 窗口值存储在 TCP 头部的窗口字段中，单位为字节，基于接收方缓冲区动态调整。
- 发送方需确保：未确认的数据总量 ≤ 接收方告知的窗口值

##### 标志位

- SYN（Synchronize）：同步序号，用于建立连接。
- ACK（Acknowledgment）：确认标志，表示报文包含确认号。
- FIN（Finish）：结束标志，用于终止连接。
- RST（Reset）：复位标志，用于处理异常情况，强制断开连接。
- PSH（Push）：推送标志，要求接收方立即将数据交给应用层。
- URG（Urgent）：紧急标志，表示报文中有紧急数据，需要优先处理。

#### UDP：用户数据报协议

无连接、不可靠、低延迟：传输前不需要建立连接，发送后不确认数据是否送达，无流量控制和拥塞控制，但传输速度快、开销小。

适用于对延迟敏感、能容忍少量丢包的场景：

- 视频通话
- DNS 查询
- 直播

## 网络层

将传输层的数据包从源设备发送到目标设备。

### 功能

- 定义设备的 IP 地址。
- 当数据包超过网络的最大传输单元 MTU（Maximum Transmission Unit，一次能传输的最大数据块大小）时，拆分成小片段传输，到达目标后再重组。
- 通过路由协议选择最优传输路径。
- 处理网络差错。
  - 数据丢失。
  - 数据损坏。
  - 数据重复。
  - 数据失序。
  - 延迟超限。

### 关键协议

#### IP：网际协议

负责给每个设备分配唯一的 IP 地址，并指导数据包在网络中传输。

- IPv4：32 位地址。
- IPv6：128 位地址。
- TTL（Time To Live，生存时间）：防止数据包在网络中无限循环，通过每经过一个路由器，TTL 值减 1，直到为 0 时丢弃数据包。

#### ICMP：互联网控制报文协议

辅助 IP 协议，用于发送网络差错报文和测试网络连通性。

- `ping` 命令就是基于 ICMP 的请求/响应报文实现的。

#### 路由协议

用于路由器之间交换路由信息，选择最佳路径传输数据包。

- OSPF：内部网关协议，用于同一公司/机构内部的路由选择。
- BGP：外部网关协议，用于不同运营商之间的路由选择。

## 链路层

在同一个局域网内，将网络层的 IP 数据包封装成帧，通过 MAC（Media Access Control，媒体访问控制）地址定位到目标设备，实现点对点的传输。

### 功能

- 定义物理地址（MAC 地址），每个网卡的 MAC 地址全球唯一。
- 将 IP 数据包封装成以太网帧，添加帧头和帧尾信息，帧头包含源 MAC 地址和目标 MAC 地址，帧尾包含校验信息。
- 处理帧的检验，通过帧尾的 FCS（Frame Check Sequence，帧校验序列）字段检查帧在传输过程中是否损坏，损坏则丢弃。
- 管理局域网内的设备接入。

### 关键协议与设备

- MAC 地址：6 字节的物理地址，用于局域网内识别设备。
- 以太网帧：局域网内传输的数据单元，包含帧头、数据和帧尾。
- ARP（Address Resolution Protocol，地址解析协议）：将 IP 地址映射到 MAC 地址。
- 交换机：根据 MAC 地址转发以太网帧，只将帧发送到目标 MAC 对应的端口。
- 链路层协议
  - PPP（Point-to-Point Protocol，点对点协议）：用于点对点连接的数据链路层协议，常用于拨号上网。
  - 802.11（无线局域网协议）：定义无线局域网的链路层标准。

## 物理层

将帧转换成比特流，通过物理介质传输。

### 功能

- 定义物理介质的电气、光学和无线特性。
- 处理比特流的传输。
- 管理物理连接的时序。
- 定义带宽。

### 关键概念

- 比特（bit）：数据的最小单位，表示为 0 或 1。
- 物理介质
  - 有线
    - 双绞线
    - 光纤
  - 无线
    - Wi-Fi
    - 蜂窝网络
- 信号
  - 电信号
    - 网线
  - 光信号
    - 光纤
  - 无线信号
    - Wi-Fi
    - 蜂窝网络
