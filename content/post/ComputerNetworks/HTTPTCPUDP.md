---
date: "2025-11-24T09:05:14+08:00"
draft: false
title: "HTTP 与 TCP、UDP 的差异"
categories:
  - ComputerNetworks
tags:
  - HTTP
  - TCP
  - UDP
---

## 协议所属网络层

| 协议 | 网络层级 |
| ---- | -------- |
| HTTP | 应用层   |
| TCP  | 运输层   |
| UDP  | 运输层   |

## 连接特性

### 连接方式

- HTTP：间接连接，HTTP 在请求/响应前需先通过 TCP 建立连接，再传输数据。
- TCP：面向连接，传输前需通过三次握手建立连接，四次挥手断开连接。
- UDP：无连接，直接发送数据，无需断开流程。

### 连接持续性

- HTTP
  - HTTP/1.0：短连接，每次请求后断开 TCP 连接。
  - HTTP/1.1：长连接，同一域名下多个请求复用一个 TCP 连接。
  - HTTP/2：多路复用，多个请求在一个 TCP 连接上并发传输。
- TCP：建立连接后保持连接状态，可持续传输多批数据，直到双方发起断开请求。
- UDP：每次发送数据都是独立的数据包，无连接保持逻辑。

## 可靠性

### HTTP

依赖 TCP 实现可靠性。

HTTP 本身不具备重传、校验机制，数据是否丢失、有序，完全由底层 TCP 负责。

### TCP

可靠传输。

- 确认机制：接收方发 ACK 确认数据送达。
- 重传机制：超时未收到 ACK 则重传数据。
- 有序传输：通过序号标记数据顺序，接收方按序重组。
- 流量控制：防止发送方过快发送数据，避免接收方缓存溢出。
- 拥塞控制：根据网络状况调整发送速率，防止网络拥塞。

### UDP

不可靠传输。

- 无确认机制：发送数据后不等待接收方确认，无法确认数据是否送达。
- 无重传机制：数据丢失后不进行重传。
- 无序传输：数据包可能乱序到达，接收方需自行处理顺序问题。
- 无流量控制和拥塞控制：发送方按自身速率发送数据，可能导致接收方丢包。

## 数据完整性

### HTTP

依赖 TCP 的校验。

HTTP 数据完整性由 TCP 帧尾的 FCS 校验来保障，其自身仅通过部分头信息字段来辅助检测数据完整性。

### TCP

多层校验。

- TCP 校验：检测端到端的传输错误，检验整个 TCP 段。
- FCS 校验：检测链路层传输错误，检验整个帧。

### UDP

基础校验。

UDP 头部含校验和字段，仅对数据报进行简单校验，校验失败则直接丢弃，不反馈、不重传。

## 传输效率

### HTTP

- HTTP/1.0：每次请求建立新连接，开销大，效率低。
- HTTP/1.1：长连接复用，减少连接开销，提高效率。
- HTTP/2：多路复用，多个请求并发传输，进一步提升效率。

### TCP

效率低：连接建立和维护开销大，拥塞控制和流量控制机制降低传输速率。

### UDP

效率高：无连接开销，无拥塞和流量控制，数据报头部仅 8 字节。

## 适用场景

- HTTP
  - 网页加载
  - API 通信
- TCP
  - 可靠数据传输
  - 远程登录
  - 文件传输
- UDP
  - 实时通信
  - 视频直播
  - 在线游戏
  - DNS 查询

## 数据格式与传输单元

### HTTP

#### 数据格式

- 请求报文
  - 请求行：请求方法+请求路径+协议版本
  - 请求头：键值对形式的元数据，用于告知服务器请求的附加信息。
  - 请求体：可选部分，常用于 POST 请求，用来传递表单数据、JSON 等内容。
- 响应报文
  - 状态行：协议版本+状态码+状态描述
  - 响应头：键值对形式的元数据，用于告知客户端响应的附加信息。
  - 响应体：服务器返回的实际数据内容，如 HTML 页面、JSON 数据等。

#### 传输单元

HTTP 本身没有专属传输单元。发送方将 HTTP 的整份报文拆成若干部分，融进 TCP 的字节流。接收方再通过 TCP 重组字节流，还原成完整的 HTTP 报文。

### TCP

#### 数据格式

TCP 不关心应用层数据的具体格式，不论是 HTTP 报文还是文件数据，都会统一封装成 TCP 段。

每个 TCP 段的头部至少 20 字节，包含源端口、目标端口、序列号和确认号等关键信息。

#### 传输单元

TCP 的传输单元是 TCP 段。段的大小受 MTU 限制。TCP 总长度超出 MTU 后就会被拆分成多个段传输。

### UDP

#### 数据格式

UDP 不关心应用层数据的具体格式，任何数据都可以封装成 UDP 数据报。

每个 UDP 数据报的头部固定 8 字节，只包含源端口、目标端口、数据包长度、校验和 4 个字段。

#### 传输单元

UDP 的传输单元是 UDP 数据报。每个数据报独立传输，大小受 MTU 限制，超出部分会被丢弃。

## 端口号与通信对象

| 协议 | 端口号范围                                             | 通信对象                                                                    |
| :--: | ------------------------------------------------------ | --------------------------------------------------------------------------- |
| HTTP | 80（未加密）<br>443（加密）                            | 应用层的客户端和服务器，通过域名+端口定位服务器应用                         |
| TCP  | 无默认端口，由应用层协议指定<br>SSH：22                | 基于“源 IP+源端口+目标 IP+目标端口”定位端到端连接，实现两台设备间的双向通信 |
| UDP  | 无默认端口，由应用层协议指定<br>DNS：53<br>DHCP：67/68 | 基于“源 IP+源端口+目标 IP+目标端口”定位通信对象，仅单向发送数据报           |

## 应用场景

- HTTP
  - 网页浏览
  - 接口调用
  - 文件下载
- TCP
  - 文件传输
  - 邮件收发
  - 远程登录
  - HTTP/1.0/1.1/2 的传输载体
- UDP
  - 实时通信
  - 视频直播
  - 在线游戏
  - DNS 查询
  - HTTP/3 的传输载体

## 协议间的依赖关系

1. HTTP 与 TCP 的依赖：HTTP 所有数据必须通过 TCP 连接传输，TCP 为 HTTP 提供可靠的数据通道。
2. HTTP 与 UDP 的关系：HTTP 本身不使用 UDP 进行传输，但 HTTP/3 采用 QUIC 协议，QUIC 基于 UDP 实现，提供类似 TCP 的可靠传输功能。
